---
import SocialList from "@/components/SocialList.astro";
import PageLayout from "@/layouts/Base.astro";

// Define interface for Medium post data
interface MediumPost {
	link: string;
	title: string;
	pubDate: string;
}

// Optimize API call with timeout and error handling
let mediumPosts: MediumPost[] = [];
try {
	const controller = new AbortController();
	const timeoutId = setTimeout(() => controller.abort(), 3000); // 3 second timeout
	
	const response = await fetch(
		"https://api.rss2json.com/v1/api.json?rss_url=https://medium.com/feed/@oakley349",
		{ signal: controller.signal }
	);
	clearTimeout(timeoutId);
	
	if (response.ok) {
		const data = await response.json();
		mediumPosts = data.items?.slice(0, 5) || []; // Limit to 5 posts
	}
} catch (error) {
	// Fallback to empty array if API fails
	console.log("Failed to fetch Medium posts, using fallback");
	mediumPosts = [];
}
---

<PageLayout meta={{ title: "Home" }}>
	<section>
		<p class="mb-14">
			Hi, I'm Oakley Hall. I'm a software engineering lead and architect for Sam's Club and Walmart
			Global Tech. I love building tools that help people work better and smarter. ðŸš€
		</p>
		<SocialList />
	</section>

	<section aria-label="Blog post list" class="mt-16">
		<h2 class="title mb-4 text-xl">Posts</h2>
		<ul class="space-y-4">
			{
				mediumPosts.map((p) => (
					<li>
						<span class="text-sm text-gray-500">{new Date(p.pubDate).toLocaleDateString()}</span>
						<a class="cactus-link" data-astro-prefetch href={p.link}>
							{p.title.length > 65 ? p.title.substring(0, 65) + "..." : p.title}
						</a>
					</li>
				))
			}
		</ul>
	</section>

	<section aria-label="Live events" class="mt-16" id="live">
		<h2 class="title mb-4 text-xl">Live</h2>
		<div class="mb-4 overflow-hidden rounded-lg">
			<img
				src="/leaddev2025.jpeg"
				alt="Oakley Hall co-hosting a session at LeadDev New York 2025"
				class="w-full aspect-[4/3] object-cover"
				width="400"
				height="300"
				loading="lazy"
				decoding="async"
			/>
			<div class="border border-slate-200 bg-slate-50 p-4 dark:border-slate-800 dark:bg-slate-900">
				<h3 class="mb-2 text-lg font-bold text-slate-900 dark:text-white">
					Co-host of Table Talk session on embedding observability in engineering culture.
				</h3>
				<a
					href="https://lnkd.in/ez-wapXr"
					class="font-medium text-blue-600 hover:underline dark:text-blue-400"
					target="_blank"
					rel="noopener noreferrer"
				>
					Learn more
				</a>
			</div>
		</div>
		<div class="mb-4 overflow-hidden rounded-lg">
			<img
				src="/leaddev2024.jpeg"
				alt="Oakley Hall hosting a session at LeadDev New York 2024"
				class="w-full aspect-[4/3] object-cover"
				width="400"
				height="300"
				loading="lazy"
				decoding="async"
			/>
			<div class="border border-slate-200 bg-slate-50 p-4 dark:border-slate-800 dark:bg-slate-900">
				<h3 class="mb-2 text-lg font-bold text-slate-900 dark:text-white">
					Host of Next Steps AMA Session on Preparing for the Role of Principal Engineer at LeadDev
					NYC
				</h3>
				<a
					href="https://lnkd.in/ez-wapXr"
					class="font-medium text-blue-600 hover:underline dark:text-blue-400"
					target="_blank"
					rel="noopener noreferrer"
				>
					Learn more
				</a>
			</div>
		</div>
	</section>
</PageLayout>
